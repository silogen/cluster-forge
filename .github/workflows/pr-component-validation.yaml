name: PR Component Validation

on:
  workflow_dispatch:
  pull_request:
    branches: [ main, update_sbom_workflow ]
    paths:
      - 'sbom/components.yaml'
      - 'root/values.yaml'
      - 'sbom/*.sh'

jobs:
  validate-components:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install yq
      run: |
        sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
        sudo chmod +x /usr/local/bin/yq
        
    - name: Validate SBOM Sync (Gatekeeper)
      working-directory: ./sbom
      run: |
        chmod +x validate-*.sh
        ./validate-sync.sh