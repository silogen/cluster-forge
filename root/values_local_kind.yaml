clusterForge:
  repoUrl: "http://gitea-http.cf-gitea.svc:3000/cluster-org/cluster-forge.git"
  targetRevision: main # use main for local development
externalValues:
  enabled: true
  repoUrl: "http://gitea-http.cf-gitea.svc:3000/cluster-org/cluster-values.git"
  targetRevision: main
  path: values_local_kind.yaml
global:
  domain: localhost.local # to be filled by bootstrap script or use localhost
enabledApps:
  # Minimal set for local development
  - argocd
  - argocd-config
  - cert-manager
  - openbao
  - openbao-config
  - external-secrets
  - external-secrets-config
  - gitea
  - gitea-config
  - gateway-api
  - metallb
  - kgateway-crds
  - kgateway
  - kgateway-config
  # Monitoring (required by AIRM)
  - prometheus-crds
  - opentelemetry-operator
  # Note: otel-lgtm-stack disabled for local-kind to save memory
  # If you need Prometheus metrics, increase Colima memory or reduce other resources
  # Database operator
  - cnpg-operator
  # Minimal storage (with reduced resources)
  - minio-operator
  - minio-tenant
  - minio-tenant-config
  # AIRM dependencies
  - rabbitmq
  - kyverno
  - kyverno-config
  - cluster-auth
  - cluster-auth-config
  - keycloak
  - keycloak-config
  - kaiwo-crds
  - kaiwo
  - kaiwo-config
  - airm
  # Optional: Add other components as needed
  - kuberay-operator
  - kserve-crds
  - appwrapper
  - kueue
  - kueue-config
# Component-specific overrides for memory reduction  
apps:
  minio-tenant:
    path: minio-tenant/7.1.1
    namespace: minio-tenant-default
    helmParameters:
      - name: tenant.pools[0].servers
        value: "1"
      - name: tenant.pools[0].volumesPerServer
        value: "1"
      - name: tenant.pools[0].size
        value: "10Gi"
      - name: tenant.pools[0].storageClassName
        value: "standard"
      - name: tenant.pools[0].resources.requests.memory
        value: "512Mi"
      - name: tenant.pools[0].resources.requests.cpu
        value: "100m"
      - name: tenant.pools[0].resources.limits.memory
        value: "1Gi"
      - name: tenant.pools[0].resources.limits.cpu
        value: "500m"
    syncWave: -2
  keycloak:
    path: keycloak-old
    namespace: keycloak
    valuesFile: values.yaml
    helmParameters:
      - name: hostname
        value: "http://localhost:8080" # Override for local port-forwarding
      - name: localDev
        value: "true" # Enable HTTP and relaxed cookie settings
      - name: domain
        value: "localhost.local" # Domain for user emails
      # Reduce Keycloak resources
      - name: resources.requests.memory
        value: "256Mi"
      - name: resources.limits.memory
        value: "512Mi"
      # Reduce PostgreSQL resources
      - name: cnpg.cluster.instances.resources.requests.memory
        value: "256Mi"
      - name: cnpg.cluster.instances.resources.limits.memory
        value: "512Mi"
    syncWave: -2
  keycloak-config:
    path: keycloak-config
    namespace: keycloak-config
    valuesFile: values.yaml
    helmParameters:
      - name: domain
        value: "localhost.local" # Use valid TLD for devuser email
    syncWave: -1
  airm:
    repoURL: "http://gitea-http.cf-gitea.svc:3000/cluster-org/core.git"
    targetRevision: "main"
    path: services/airm/helm/airm
    namespace: airm
    valuesFile: values.yaml
    helmParameters:
      - name: airm-api.airm.appDomain
        value: "localhost.local" # Use valid TLD for email validation
      - name: airm-api.airm.frontend.nextauthUrl
        value: "http://localhost:8000" # Override for local port-forwarding
      - name: airm-api.airm.backend.image.tag
        value: local
      - name: airm-dispatcher.airm.dispatcher.image.tag
        value: local
      # Reduce UI resources for local development
      - name: airm-ui.resources.requests.memory
        value: "256Mi"
      - name: airm-ui.resources.limits.memory
        value: "512Mi"
      # Reduce API resources
      - name: airm-api.resources.requests.memory
        value: "512Mi"
      - name: airm-api.resources.limits.memory
        value: "512Mi"
      # Reduce dispatcher resources
      - name: airm-dispatcher.resources.requests.memory
        value: "512Mi"
      - name: airm-dispatcher.resources.limits.memory
        value: "512Mi"
      # Reduce RabbitMQ resources
      - name: airm-rabbitmq.resources.requests.memory
        value: "512Mi"
      - name: airm-rabbitmq.resources.limits.memory
        value: "512Mi"
      # Reduce PostgreSQL resources
      - name: airm-cnpg.cluster.instances.resources.requests.memory
        value: "256Mi"
      - name: airm-cnpg.cluster.instances.resources.limits.memory
        value: "512Mi"
    syncOptions:
      - ServerSideApply=false # Disable SSA for hooks to work properly
    syncWave: 0
