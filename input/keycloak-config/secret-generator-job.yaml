---
apiVersion: batch/v1
kind: Job
metadata:
  name: keycloak-secret-generator
  namespace: keycloak
spec:
  template:
    spec:
      serviceAccountName: keycloak-secret-generator-sa
      containers:
      - name: secret-generator
        image: ghcr.io/silogen/kubectl:latest
        imagePullPolicy: IfNotPresent
        command: ["/bin/bash"]
        args: ["/scripts/generate-secrets.sh"]
        volumeMounts:
        - name: script-volume
          mountPath: /scripts
      volumes:
      - name: script-volume
        configMap:
          name: keycloak-secret-generator-script
          defaultMode: 0755
      restartPolicy: OnFailure
  backoffLimit: 3
