# Copyright Â© Advanced Micro Devices, Inc., or its affiliates.
#
# SPDX-License-Identifier: MIT

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: "{{ .Release.Name }}-secret-generator-sa"
  namespace: "{{ .Release.Namespace }}"
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "-1"

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: "{{ .Release.Name }}-secret-generator-role"
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "-1"
rules:
  - apiGroups: ["external-secrets.io"]
    resources: ["clustersecretstores"]
    verbs: ["create", "update", "patch", "get", "list"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: "{{ .Release.Name }}-secret-generator-binding"
  annotations:
    helm.sh/hook: pre-install
    helm.sh/hook-weight: "-1"
subjects:
  - kind: ServiceAccount
    name: "{{ .Release.Name }}-secret-generator-sa"
    namespace: "{{ .Release.Namespace }}"
roleRef:
  kind: ClusterRole
  name: "{{ .Release.Name }}-secret-generator-role"
  apiGroup: rbac.authorization.k8s.io
