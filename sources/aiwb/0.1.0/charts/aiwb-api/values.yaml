# Copyright Â© Advanced Micro Devices, Inc., or its affiliates.
#
# SPDX-License-Identifier: MIT

---
# Default values for AIWB API subchart

# Label prefix for workload identification
# Used for workload-id, project-id labels on pods and in metrics
# TODO: Will change to "apps.eai.amd.com" in the future
labelPrefix: "airm.silogen.ai"

# Backend (API) configuration
backend:
  image:
    repository: aiwb-api
    pullPolicy: IfNotPresent
    tag: "latest"
  # NOTE: AIWB currently only supports 1 replica due to the poller/syncer setup.
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8002
    targetPort: 8002
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 512Mi
  imagePullSecrets: []
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: false
  nodeSelector: {}
  affinity: {}
  tolerations: []
  # Polling Intervals (seconds)
  polling:
    syncerPollingIntervalSeconds: 5
    syncerPendingTimeoutSeconds: 60
  # Dataset Configuration
  datasets:
    maxFileSizeMB: 100

# Frontend (UI) configuration
frontend:
  image:
    repository: aiwb-ui
    pullPolicy: IfNotPresent
    tag: "latest"
  replicaCount: 1
  service:
    port: 8000
    targetPort: 8000
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi
  imagePullSecrets: []
  appDomain: "aiwb.example.com"
  nextAuthSecretName: "aiwb-nextauth-secret"

# Database configuration (PostgreSQL)
database:
  host: "aiwb-cnpg-rw.aiwb.svc.cluster.local"
  port: 5432
  name: "aiwb"
  secretName: "aiwb-cnpg-user"

# Keycloak/OIDC configuration
keycloak:
  url: "http://keycloak.keycloak.svc.cluster.local:8080"
  internalUrl: "http://keycloak.keycloak.svc.cluster.local:8080"
  realm: "airm"
  clientId: "354a0fa1-35ac-4a6d-9c4d-d661129c2cd0"
  secretName: "aiwb-ui-keycloak-secret"

# MinIO configuration
minio:
  url: "http://minio.minio.svc.cluster.local:9000"
  bucket: "aiwb-bucket"
  accessKeySecretName: "aiwb-minio-access-key"
  secretKeySecretName: "aiwb-minio-secret-key"

# ClusterAuth configuration (for API key management)
clusterAuth:
  url: "http://cluster-auth.cluster-auth.svc.cluster.local:48012"
  secretName: "aiwb-cluster-auth-secret"

# AIM Configuration
# NOTE: In standalone mode, a namespace-scoped AIMRuntimeConfig is created.
# When running with AIRM, it provides the cluster-scoped AIMClusterRuntimeConfig.
aim:
  runtimeConfigName: "aiwb-runtime-config"
  gatewayNamespace: "kgateway-system"
  gatewayName: "https"
  clusterHost: "aiwb.example.com"
  pvcHeadroomPercent: 100
  routing:
    enabled: true
    requestTimeout: "30m"

# PostgreSQL CNPG Configuration
postgresql:
  image: "ghcr.io/cloudnative-pg/postgresql:17.2"
  instances: 3
  username: "aiwb_user"
  userSecretName: "aiwb-cnpg-user"
  superuserSecretName: "aiwb-cnpg-superuser"
  sharedBuffers: "256MB"
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  storage:
    size: "10Gi"
    storageClass: "default"
  walStorage:
    size: "2Gi"
    storageClass: "default"

# OpenTelemetry Collector Configuration (for vLLM metrics)
# NOTE: Only deployed in standalone mode. When running with AIRM, it manages the collector.
otelCollector:
  image: "otel/opentelemetry-collector-contrib:0.114.0"
  scrapeInterval: "30s"
  endpoint: "http://prometheus-remote-write.monitoring.svc.cluster.local:9090/api/v1/write"

# RBAC configuration
rbac:
  serviceAccountName: "aiwb"
